<Window x:Class="AuditHistoryExtractorPro.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AuditHistoryExtractorPro.Desktop"
        mc:Ignorable="d"
        Title="Audit History Extractor Pro - Desktop"
        Height="680"
        Width="1120"
        MinHeight="620"
        MinWidth="960"
        WindowStartupLocation="CenterScreen"
        Background="White">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#F3F2F1" Padding="20,14" BorderBrush="#E1DFDD" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Vertical">
                    <TextBlock Text="Audit History Extractor Pro" FontSize="22" FontWeight="SemiBold" Foreground="#323130" />
                    <TextBlock Text="Cliente nativo WPF (.NET 8)" FontSize="12" Foreground="#605E5C" Margin="0,4,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0">
                    <Ellipse Width="12" Height="12" Margin="0,0,8,0">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#F25022" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                        <Setter Property="Fill" Value="#7FBA00" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock VerticalAlignment="Center" Foreground="#323130" FontWeight="SemiBold">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="Desconectado" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                        <Setter Property="Text" Value="Conectado" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Margin="20">
            <TabControl>
                <TabItem Header="Configuración">
                    <Grid Margin="14">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="0,0,0,12">
                            <TextBlock Text="URL Dataverse" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                            <TextBox Text="{Binding CrmUrl, UpdateSourceTrigger=PropertyChanged}" MinWidth="520" Height="34" Padding="8,6" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Margin="0,0,0,12">
                            <TextBlock Text="Entidad" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                            <TextBox Text="{Binding EntityName, UpdateSourceTrigger=PropertyChanged}" MinWidth="300" Height="34" Padding="8,6" />
                        </StackPanel>

                        <Grid Grid.Row="2" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                <TextBlock Text="Rango de Fecha" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                                <ComboBox ItemsSource="{Binding DateRangeOptions}"
                                          SelectedItem="{Binding SelectedDateRange}"
                                          Height="34" />
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="8,0">
                                <TextBlock Text="Usuario" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                                <ComboBox ItemsSource="{Binding AvailableUsers}"
                                          SelectedItem="{Binding SelectedUser}"
                                          DisplayMemberPath="Name"
                                          Height="34" />
                            </StackPanel>

                            <StackPanel Grid.Column="2" Margin="8,0,0,0">
                                <TextBlock Text="Operación" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                                <ComboBox ItemsSource="{Binding OperationOptions}"
                                          SelectedItem="{Binding SelectedOperation}"
                                          Height="34" />
                            </StackPanel>
                        </Grid>

                        <StackPanel Grid.Row="3" Margin="0,0,0,12">
                            <TextBlock Text="Ruta Excel" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,0,6" />
                            <TextBox Text="{Binding OutputPath, UpdateSourceTrigger=PropertyChanged}" Height="34" Padding="8,6" />
                        </StackPanel>

                        <StackPanel Grid.Row="4" Orientation="Horizontal" VerticalAlignment="Top">
                            <Button Content="Conectar"
                                    Command="{Binding ConnectCommand}"
                                    Background="#00A4EF"
                                    Foreground="White"
                                    BorderBrush="#0095D9"
                                    FontWeight="SemiBold"
                                    Padding="18,8"
                                    Margin="0,0,10,0" />

                            <Button Content="Extraer"
                                    Command="{Binding ExtractCommand}"
                                    Background="#7FBA00"
                                    Foreground="White"
                                    BorderBrush="#6D9F00"
                                    FontWeight="SemiBold"
                                    Padding="18,8" />

                            <ProgressBar Width="140"
                                         Height="8"
                                         Margin="16,12,0,0"
                                         IsIndeterminate="{Binding IsBusy}"
                                         VerticalAlignment="Center" />
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Logs">
                    <Grid Margin="14">
                        <TextBox Text="{Binding StatusMessage}" IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>

        <Border Grid.Row="2" BorderBrush="#E1DFDD" BorderThickness="1,1,0,0" Padding="16,10" Background="#FAF9F8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="220" />
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Estado:" FontWeight="SemiBold" Foreground="#323130" Margin="0,0,8,0" />
                    <TextBlock Text="{Binding StatusMessage}" Foreground="#605E5C" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                    <ProgressBar Minimum="0" Maximum="100" Value="{Binding ProgressValue}" Height="12" />
                    <TextBlock Text="{Binding ProgressValue, StringFormat=Progreso: {0:F0}%}" FontSize="11" Foreground="#605E5C" HorizontalAlignment="Right" Margin="0,4,0,0" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
